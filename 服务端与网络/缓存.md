# 缓存

## 强缓存
　　强缓存在客户端和服务器端都会存在。
* 客户端：客户端在请求资源前，会检查上一次该资源响应头的 `Cache-Control` 字段，如果该字段的值为 max-age = time (大于 0 的毫秒数)，如果该资源缓存的时间没有过这个时间值，**则直接使用本地的缓存，而不像服务器发请求**。
* 服务器端：服务器端在接收到一个请求后，如果该请求的头部 `Cache-Control` 字段的值为 max-age = time (大于 0 的毫秒数)，如果距离上一次返回资源的时间小于这个毫秒数，那么服务器不会读取新的资源，而是直接返回 304，告知客户端使用自己本地上次缓存的资源即可。


<br>

## 对比缓存
　　在没有走强缓存逻辑的情况下，服务器端会进行 `Last-Modified` 和 `Etag` 的校验，如果校验发现资源未更新，则会返回 **304** ，否则会返回新的资源实体。

### Etag
　　首部字段 ETag 能告知客户端实体标识。它是一种可将资源以字符串形式做唯一性标识的方式。服务器会为每份资源分配对应的 ETag 值。


　　另外，当资源更新时，ETag 值也需要更新。生成 ETag 值时，并没有统一的算法规则，而仅仅是由服务器来分配。资源被缓存时，就会被分配唯一性标识。例如，当使用中文版的浏览器访问 http://www.google.com/ 时，就会返回中文版对应的资源，而使用英文版的浏览器访问时，则会返回英文版对应的资源。两者的 URI 是相同的，所以仅凭 URI 指定缓存的资源是相当困难的。若在下载过程中出现连接中断、再连接的情况，都会依照 ETag 值来指定资源。

### Last-Modified/If-Modified-Since
　　Last-Modified/If-Modified-Since 要配合 Cache-Control 使用。 
* Last-Modified：标示这个响应资源的最后修改时间。 
* If-Modified-Since：当资源过期时（使用 Cache-Control 标识的max-age），发现资源具有Last-Modified声明，则再次向 web 服务器请求时带上头 If-Modified-Since，表示请求时间。

<br>

### 流程图
<div align="center">
  <img src="https://github.com/TanYJie/Technology-Stack-Interview-Experience/blob/master/服务端与网络/image/HTTP缓存.png"/>
</div>
